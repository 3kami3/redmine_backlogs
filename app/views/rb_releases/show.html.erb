<div class="contextual">
<%= link_to_if_authorized l(:button_edit),   {:controller => 'rb_releases', :action => 'edit',    :release_id => @release}, :class => 'icon icon-edit', :accesskey => accesskey(:edit) %>
<%= link_to_if_authorized l(:button_delete), {:controller => 'rb_releases', :action => 'destroy', :release_id => @release}, :confirm => l(:text_are_you_sure), :class => 'icon icon-del', :method => :delete %>
</div>

<h2><%= h @release.name %></h2>
<h3>Release Burndown</h3>
<!--Release Burndown Visualization-->
<% unless @release.has_burndown? %>
  <p class="nodata">No burndown available</p>
<% else %>
  <div id="release_burndown_<%= @release.id %>" style="margin-left:0px; margin-top:20px;"></div>
  <%= render :partial => "rb_release_burndown_charts/burndown", :locals => {:div => 'release_burndown_', :burndown => @release.burndown } %>

  <br />
  <div class="box">
  <% if @release.today %>
    <%= link_to l(:release_update_snapshot_today), {:controller => 'rb_releases', :action => 'snapshot', :release_id => @release}, :class => 'icon icon-save' %>
    (current: <%= @release.today.remaining_story_points %> / new: <b><%= @remaining_story_points  %></b>)
  <% else %>
    <% if Date.today >= @release.release_start_date and Date.today <= @release.release_end_date %>
      <%= link_to l(:release_create_snapshot_today), {:controller => 'rb_releases', :action => 'snapshot', :release_id => @release}, :class => 'icon icon-add' %>
    <% else %>
      <%= link_to l(:release_create_snapshot_today), {:controller => 'rb_releases', :action => 'snapshot', :release_id => @release}, :confirm => l(:today_not_in_release_msg), :class => 'icon icon-add' %>
      <br />
      <b><%= l(:today_not_in_release_warning) %></b>
    <% end %>
  <% end %>
  </div>

<!--Visualization of related sprints -->
<!--TODO: i18n-->
<br><h3>Sprints</h3>

<% @release.stories_by_sprint.each do |v,list|
    version = Version.find(v) %>
<div id="sprints" style="padding-bottom:2em;">
	<h3 class="version"><%= tag 'a', :name => version.name %><%= link_to_version version %></h3>
	<%= render :partial => 'versions/overview', :locals => {:version => version} %>
	<%= render(:partial => "wiki/content", :locals => {:content => version.wiki_page.content}) if version.wiki_page %>
  <%= call_hook :view_projects_roadmap_version_bottom, :version => version %>
<%
    list.sort_by!{|i|i.position} %>
  <table class="list issues">
    <tr>
      <th>#</th>
      <th>Tracker</th>
      <th>Subject</th>
      <th>Story Points</th>
    </tr>
<%  list.each do |story| %>
    <tr>
      <td><%= link_to story.id, {:controller => 'issues', :action => 'show', :id => story.id} %></td>
      <td><%= h tracker_name_or_empty(story) %></td>
      <td><%= story.subject %></td>
      <td><%= story_points_or_empty(story) %></td>
    </tr>
<%  end %>
  </table>
</div>
<%end %>

<div id="releasebacklog">
<h3>Release Backlog</h3>
<table class="list issues">
<tr>
  <th>#</th>
  <th>Tracker</th>
  <th>Subject</th>
  <th>Story Points</th>
</tr>
<% RbStory.release_backlog(@release).each{|story| %>
<tr>
<td><%= link_to story.id, {:controller => 'issues', :action => 'show', :id => story.id} %></td>
<td><%= h tracker_name_or_empty(story) %></td>
<td><%= story.subject %></td>
<td><%= story_points_or_empty(story) %></td>
</tr>
<% } %>
</table>
</div>

  <% other_formats_links do |f| %>
    <%= f.link_to 'CSV', :url => { :release_id => @release } %>
  <% end %>
  <br />
<% end %>

<% content_for :sidebar do %>
  <h3><%= l(:label_release) %></h3>
  <p><b><%= l(:field_release_start_date) %>:</b>   <%= @release.release_start_date   %></p>
  <p><b><%= l(:field_release_end_date) %>:</b>     <%= @release.release_end_date     %></p>
  <p><b><%= l(:field_initial_story_points) %>:</b> <%= @release.initial_story_points %></p>
  <p><b><%= l(:remaining_story_points) %>:</b>     <%= @remaining_story_points       %></p>
  <p><b><%= l(:field_number_of_snapshots) %>:</b>  <%= @release.burndown_days.size   %></p>
<% end %>

<% html_title(@release.name) -%>
