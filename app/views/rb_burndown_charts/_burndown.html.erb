<div style="width:650px; height: 300px" class="burndown_chart" id="burndown_<%= sprint.id %>"><div class="loading">Generating chart...</div></div>
<script type="text/javascript" language="javascript">
  <%-
      burndown = sprint.burndown
      series = burndown.series.sort{|a, b| l("label_#{a}") <=> l("label_#{b}") }
      dates = sprint.days(:all)
      dates = [dates[0] - 1] + dates

      chart = {
        :series => series.collect{|s| burndown[s]},
        :position => Hash[*(0.upto(series.size - 1).collect{|i| [series[i], i]}.flatten)],
        :options => {
          :series => series.collect{|s| {:label => l("label_#{s}"), :yaxis => (s.to_s =~ /^points/ ? 'y2axis' : 'yaxis')}},
          :legend => {:show => (mode == :full), :location => 'sw'},
          :grid => {:shadow => false},
          :seriesDefaults => {:showMarker => (mode == :full), :shadow => false},
          :axesDefaults =>  {:showTick => (mode == :full)},
          :axes => {
              :xaxis => {
                :min => 1,
                :max => dates.size,
                :tickInterval => 1,
                :ticks => dates.enum_for(:each_with_index).collect{|d,i| [i+1, ::I18n.t('date.abbr_day_names')[d.wday % 7]]}
              },
              :yaxis => {:min => 0, :max => burndown[:max_hours], :tickOptions => {:formatString => '%d'}},
              :y2axis => {:min => 0, :max => burndown[:max_points], :tickOptions => {:formatString => '%d'}}
          },
          :highlighter => { :tooltipAxes => 'y', :formatString => '%s' }
        }
      }
  %>
  RB.burndown.charts[<%= sprint.id %>] = <%= chart.to_json %>;
  RB.burndown.initialize();
</script>
